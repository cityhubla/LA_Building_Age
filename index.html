<!DOCTYPE html>
<html>
  <head>
    <title>Age of Los Angeles</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.js"
    ></script>
  </head>
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "//www.google-analytics.com/analytics.js",
      "ga"
    );

    ga("create", "UA-63392200-1", "auto");
    ga("send", "pageview");
  </script>
  <body>
    <div id="map"></div>
    <div id="info_mobile">
      <img src="images/builtla_mobile.png" />
      <div id="icons">
        <img
          src="images/about.png"
          onclick='aboutfunc("#aboutboxmobile")'
          id="abouticon"
        />
        <img
          src="images/animate.png"
          onclick="animate2(),animate2()"
          id="divback"
        />
      </div>
      <div id="aboutboxmobile">
        <h3>
          The mobile version does not allow pan or zoom yet, please use a
          desktop for full use
        </h3>
        <p>
          Built:LA created by <a href="https://www.theworks.la/">Omar Ureta</a
          ><a href="https://www.mapbox.com/">Mapbox Studio and Mapbox-GL</a>,
          inspired by
          <a href="http://labratrevenge.com/pdx/#12/45.4554/-122.6531"
            >Portland, Oregon: The Age of a City</a
          >
          Terrain and Label Data by <a href="http://www.mapbox.com">Mapbox</a>.
          <a href="http://openstreetmap.org">OpenStreetMap</a>, under
          <a href="http://www.openstreetmap.org/copyright">ODbL</a>.
        </p>
        <p>
          Thanks goes out to <a href="http://maptime.io/">Maptime</a> for
          opening the doors to amazing cartographic possibilities!!
        </p>

        <p>
          Code and map research can be found on
          <a href="https://github.com/cityhubla/LA_Building_Age">Github</a>
        </p>
      </div>
    </div>
    <div id="info">
      <img src="images/builtla_logo_v2.png" />
      <div id="timeline">
        <img
          src="images/time1909.png"
          onclick='changestyle("tileset1900",this)'
          id="tileset1900"
        />
        <img
          src="images/time1910.png"
          onclick='changestyle("tileset1910",this)'
          id="tileset1910"
        />
        <img
          src="images/time1920.png"
          onclick='changestyle("tileset1920",this)'
          id="tileset1920"
        />
        <img
          src="images/time1930.png"
          onclick='changestyle("tileset1930",this)'
          id="tileset1930"
        />
        <img
          src="images/time1940.png"
          onclick='changestyle("tileset1940",this)'
          id="tileset1940"
        />
        <img
          src="images/time1950.png"
          onclick='changestyle("tileset1950",this)'
          id="tileset1950"
        />
        <img
          src="images/time1960.png"
          onclick='changestyle("tileset1960",this)'
          id="tileset1960"
        />
        <img
          src="images/time1970.png"
          onclick='changestyle("tileset1970",this)'
          id="tileset1970"
        />
        <img
          src="images/time1980.png"
          onclick='changestyle("tileset1980",this)'
          id="tileset1980"
        />
        <img
          src="images/time1990.png"
          onclick='changestyle("tileset1990",this)'
          id="tileset1990"
        />
        <img
          src="images/time2000.png"
          onclick='changestyle("tileset2000",this)'
          id="tileset2000"
        />
      </div>
      <div id="icons">
        <img
          src="images/about.png"
          onclick='aboutfunc("#aboutbox")'
          id="abouticon"
        />
        <img
          src="images/animate.png"
          onclick="animate2(),animate2()"
          id="divback"
        />
      </div>
      <div id="builtbox">Hover over a building for year built</div>
      <div id="infobox"></div>

      <div id="aboutbox">
        <p>
          Built:LA developed by
          <a href="http://www.theworks.la/">Omar Ureta</a>
          <a href="https://www.linkedin.com/pub/omar-ureta/55/95a/871">
            (Linkedin)</a
          >. Made with
          <a href="https://www.mapbox.com/">Mapbox Studio and Mapbox-GL</a>,
          inspired by
          <a href="http://labratrevenge.com/pdx/#12/45.4554/-122.6531"
            >Portland, Oregon: The Age of a City</a
          >
          Terrain and Label Data by <a href="http://www.mapbox.com">Mapbox</a>.
          <a href="http://openstreetmap.org">OpenStreetMap</a>, under
          <a href="http://www.openstreetmap.org/copyright">ODbL</a>.
        </p>
        <p>
          Thanks goes out to <a href="http://maptime.io/">Maptime</a> for
          opening the doors to amazing cartographic possibilities!!
        </p>

        <p>
          Code and map update logs can be found on
          <a href="https://github.com/cityhubla/LA_Building_Age">Github</a>
        </p>
        <p>
          Data // Building Outlines:
          <a
            href="http://egis3.lacounty.gov/dataportal/2011/04/28/countywide-building-outlines/"
            >LA County GIS Data Portal</a
          >, Age Attributes
          <a href="http://gis.ats.ucla.edu/Mapshare/"
            >LA County Assessor Local Roll</a
          >
          (Note: There were buildings that had no data on the time they were
          built. They are shown, only greyed out.)
        </p>
        <p>
          This map uses WEBGL, which is optimized for Chrome and Firefox, Safari
          users need to enable
          <a href="https://discussions.apple.com/thread/3300585?start=0"
            >WEBGL</a
          >
        </p>
      </div>
    </div>

    <script>
      //Server Address will change every month
      var mapDiv = "map";
      var tileset0000 =
        "https://builtla.planninglabs.la/nodata/{z}/{x}/{y}.pbf";
      var tileset1890 =
        "https://builtla.planninglabs.la/1890-1899/{z}/{x}/{y}.pbf";
      var tileset1900 =
        "https://builtla.planninglabs.la/1900-1909/{z}/{x}/{y}.pbf";
      var tileset1910 =
        "https://builtla.planninglabs.la/1910-1919/{z}/{x}/{y}.pbf";
      var tileset1920 =
        "https://builtla.planninglabs.la/1920-1929/{z}/{x}/{y}.pbf";
      var tileset1930 =
        "https://builtla.planninglabs.la/1930-1939/{z}/{x}/{y}.pbf";
      var tileset1940 =
        "https://builtla.planninglabs.la/1940-1949/{z}/{x}/{y}.pbf";
      var tileset1950 =
        "https://builtla.planninglabs.la/1950-1959/{z}/{x}/{y}.pbf";
      var tileset1960 =
        "https://builtla.planninglabs.la/1960-1969/{z}/{x}/{y}.pbf";
      var tileset1970 =
        "https://builtla.planninglabs.la/1970-1979/{z}/{x}/{y}.pbf";
      var tileset1980 =
        "https://builtla.planninglabs.la/1980-1989/{z}/{x}/{y}.pbf";
      var tileset1990 =
        "https://builtla.planninglabs.la/1990-1999/{z}/{x}/{y}.pbf";
      var tileset2000 =
        "https://builtla.planninglabs.la/2000-2009/{z}/{x}/{y}.pbf";
      var tilesetcities =
        "https://builtla.planninglabs.la/cities/{z}/{x}/{y}.pbf";
      var bkbackground = "#4f4d4d";

      //Change Button Color
      function changestyle(var1, btn) {
        var layerID = var1;
        console.log(btn);
        var visible = map.getLayoutProperty(layerID, "visibility");
        console.log(layerID);
        if (visible === "visible") {
          $(btn).css("opacity", ".5");
          map.setLayoutProperty(layerID, "visibility", "none");
        } else {
          map.setLayoutProperty(layerID, "visibility", "visible");
          $(btn).css("opacity", "1");
        }
      }

      //Show About Information
      function aboutfunc(box) {
        $(box).toggle();
      }

      var mapStyle = {
        version: 8,
        sources: {
          // mapbox: {
          //   type: "vector",
          //   tiles: "mapbox://mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v6",
          // },
          tileset1890: {
            type: "vector",
            tiles: [tileset1890],
          },
          tileset1900: {
            type: "vector",
            tiles: [tileset1900],
          },
          tileset1910: {
            type: "vector",
            tiles: [tileset1910],
          },
          tileset1920: {
            type: "vector",
            tiles: [tileset1920],
          },
          tileset1930: {
            type: "vector",
            tiles: [tileset1930],
          },
          tileset1940: {
            type: "vector",
            tiles: [tileset1940],
          },
          tileset1950: {
            type: "vector",
            tiles: [tileset1950],
          },
          tileset1960: {
            type: "vector",
            tiles: [tileset1960],
          },
          tileset1970: {
            type: "vector",
            tiles: [tileset1970],
          },
          tileset1980: {
            type: "vector",
            tiles: [tileset1980],
          },
          tileset1990: {
            type: "vector",
            tiles: [tileset1990],
          },
          tileset2000: {
            type: "vector",
            tiles: [tileset2000],
          },
          tileset0000: {
            type: "vector",
            tiles: [tileset0000],
          },
          tilesetcities: {
            type: "vector",
            tiles: [tilesetcities],
          },
        },
        layers: [
          {
            id: "background",
            paint: {
              "background-color": "#4f4d4d",
            },
            type: "background",
          },
          {
            id: "tileset1890",
            source: "tileset1890",
            "source-layer": "1890-1899",
            paint: {
              "fill-color": "#d7d4d4",
            },
            type: "fill",
          },
          {
            id: "tileset1900",
            source: "tileset1900",
            "source-layer": "1900-1909",
            paint: {
              "fill-color": "#22ecf0",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1910",
            source: "tileset1910",
            "source-layer": "1910-1919",
            paint: {
              "fill-color": "#19d1fd",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1920",
            source: "tileset1920",
            "source-layer": "1920-1929",
            paint: {
              "fill-color": "#14b1fd",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1930",
            source: "tileset1930",
            "source-layer": "1930-1939",
            paint: {
              "fill-color": "#2c7fdb",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1940",
            source: "tileset1940",
            "source-layer": "1940-1949",
            paint: {
              "fill-color": "#3d52bf",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1950",
            source: "tileset1950",
            "source-layer": "1950-1959",
            paint: {
              "fill-color": "#6539b3",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1960",
            source: "tileset1960",
            "source-layer": "1960-1969",
            paint: {
              "fill-color": "#a032b2",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1970",
            source: "tileset1970",
            "source-layer": "1970-1979",
            paint: {
              "fill-color": "#d124a9",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1980",
            source: "tileset1980",
            "source-layer": "1980-1989",
            paint: {
              "fill-color": "#fd4dab",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset1990",
            source: "tileset1990",
            "source-layer": "1990-1999",
            paint: {
              "fill-color": "#14b1fd",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "tileset2000",
            source: "tileset2000",
            "source-layer": "2000-2009",
            paint: {
              "fill-color": "#ff7911",
            },
            type: "fill",
            layout: {
              visibility: "visible",
            },
          },
          {
            id: "nodata",
            source: "tileset0000",
            "source-layer": "NODATE",
            paint: {
              "fill-color": "#d7d4d4",
              "fill-opacity": 0.4,
            },
            type: "fill",
          },
          {
            id: "tilesetcities",
            source: "tilesetcities",
            "source-layer": "cities",
            paint: {
              "line-color": "#FFF",
              "line-opacity": 0.25,
            },
            type: "line",
          },
        ],
      };

      mapboxgl.accessToken =
        "pk.eyJ1IjoiY3J1emluNzN2dyIsImEiOiI3RDdhUi1NIn0.jaEqREZw7QQMRafKPNBdmA";
      var map = new mapboxgl.Map({
        container: "map", // container id
        style: mapStyle, //stylesheet location
        center: [-118.2621, 34.0267], // starting position
        zoom: 12, // starting zoom
        minZoom: 12,
        hash: true,
      });

      map.on("error", () => {
        console.log("Nothing at this location");
      });

      map.on("mousemove", (e) => {
        const features = map.queryRenderedFeatures(e.point);
        if (features[0]) {
          document.getElementById("builtbox").innerHTML =
            features[0].properties.address +
            " was built in " +
            features[0].properties.YearBuilt;
        }
      });

      map.on("click", (e) => {
        const features = map.queryRenderedFeatures(e.point);
        if (features[0]) {
          alert(
            features[0].properties.address +
              " was built in " +
              features[0].properties.YearBuilt
          );
        }
      });

      var yearArray = [
        "tileset1900",
        "tileset1910",
        "tileset1920",
        "tileset1930",
        "tileset1940",
        "tileset1950",
        "tileset1960",
        "tileset1970",
        "tileset1980",
        "tileset1990",
        "tileset2000",
      ];
      var yearLength = yearArray.length;
      var tx;
      function animate2() {
        tx = 1000;
        for (var i = 0; i < yearLength; i++) {
          var visible = map.getLayoutProperty(yearArray[i], "visibility");
          if (visible === "none") {
            animate3(yearArray[i]);
            tx = tx + 1000;
          } else {
            map.setLayoutProperty(yearArray[i], "visibility", "none");
            $("#" + yearArray[i]).css("opacity", ".5");
          }
        }
      }

      function animate3(layerID) {
        console.log(tx);
        setTimeout(function () {
          map.setLayoutProperty(layerID, "visibility", "visible");
          $("#" + layerID).css("opacity", "1");
        }, tx);
      }
    </script>
  </body>
</html>
